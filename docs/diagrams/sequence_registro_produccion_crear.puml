@startuml sequence_registro_produccion_crear
title Secuencia: Crear Registro de ProducciÃ³n

actor Cliente as User
participant "RegistroProduccionController" as Ctrl
participant "RegistroProduccionService" as Srv
participant "RegistroProduccionRepository (In-Memory)" as RepoProd
participant "EmpleadoRepository (In-Memory)" as RepoEmp
participant "RegistroProduccion" as ModelProd
participant "Empleado" as ModelEmp
participant "RegistroProduccionDTO" as DTOProd

User -> Ctrl : POST /api/v1/registros-produccion (body: RegistroProduccionDTO)
activate Ctrl
Ctrl -> Srv : crearRegistroProduccion(registroDTO)
activate Srv

Srv -> RepoEmp : findById(registroDTO.getEmpleadoId())
activate RepoEmp
RepoEmp --> Srv : Optional<Empleado>
deactivate RepoEmp

alt Empleado Encontrado
    Srv -> DTOProd : mapToEntity(registroDTO, empleadoEncontrado)
    activate DTOProd
    DTOProd --> Srv : registroProduccionEntity
    deactivate DTOProd

    Srv -> RepoProd : save(registroProduccionEntity)
    activate RepoProd
    RepoProd --> Srv : registroGuardado
    deactivate RepoProd

    Srv -> ModelProd : mapToDTO(registroGuardado)
    activate ModelProd
    ModelProd --> Srv : registroDTOResult
    deactivate ModelProd
    Srv --> Ctrl : registroDTOResult
    Ctrl --> User : HTTP 201 Created (body: RegistroProduccionDTO)
else Empleado No Encontrado
    Srv --> Ctrl : throws ResourceNotFoundException("Empleado no encontrado")
    deactivate Srv
    Ctrl -> GlobalExceptionHandler : maneja ResourceNotFoundException
    GlobalExceptionHandler --> Ctrl : ResponseEntity (Error)
    Ctrl --> User : HTTP 404 Not Found (Error: Empleado no encontrado)
end
deactivate Ctrl
@enduml
