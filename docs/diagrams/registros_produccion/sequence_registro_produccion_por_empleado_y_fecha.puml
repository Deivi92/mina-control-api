@startuml sequence_registro_produccion_por_empleado_y_fecha
title Secuencia: Obtener Registros de Producción por Empleado y Fecha

actor Cliente as User
participant "RegistroProduccionController" as Ctrl
participant "RegistroProduccionService" as Srv
participant "RegistroProduccionRepository (In-Memory)" as RepoProd
participant "EmpleadoRepository (In-Memory)" as RepoEmp
participant "RegistroProduccion" as ModelProd
participant "Empleado" as ModelEmp
participant "RegistroProduccionResponseDTO" as ResDTO

User -> Ctrl : GET /api/registros-produccion/empleado/{empleadoId}/fecha/{fecha}
activate Ctrl
Ctrl -> Srv : obtenerRegistrosPorEmpleadoYFecha(empleadoId, fecha)
activate Srv

Srv -> Srv : validarFormatoFecha(fecha)
note right of Srv: Valida que la fecha tenga\nel formato correcto (yyyy-MM-dd)

alt Formato Fecha Válido
    Srv -> RepoEmp : findById(empleadoId)
    activate RepoEmp
    RepoEmp --> Srv : Optional<Empleado>
    deactivate RepoEmp

    alt Empleado Encontrado
        Srv -> RepoProd : findByResponsableTurnoIdAndFechaRegistro(empleadoId, fechaParseada)
        activate RepoProd
        RepoProd --> Srv : List<RegistroProduccion>
        deactivate RepoProd
        
        Srv -> Srv : construirResponseDTOs(listaRegistros, empleadoEncontrado)
        note right of Srv: Convierte cada entidad a DTO\ncon información del empleado
        
        Srv --> Ctrl : List<RegistroProduccionResponseDTO>
        Ctrl --> User : HTTP 200 OK (body: List<RegistroProduccionResponseDTO>)
    else Empleado No Encontrado
        Srv --> Ctrl : throws RecursoNoEncontradoException("Empleado no encontrado")
        Ctrl -> GlobalExceptionHandler : maneja RecursoNoEncontradoException
        GlobalExceptionHandler --> Ctrl : ResponseEntity (Error)
        Ctrl --> User : HTTP 404 Not Found (Error: Empleado no encontrado)
    end
else Formato Fecha Inválido
    Srv --> Ctrl : throws IllegalArgumentException("Formato de fecha inválido")
    Ctrl -> GlobalExceptionHandler : maneja IllegalArgumentException
    GlobalExceptionHandler --> Ctrl : ResponseEntity (Error)
    Ctrl --> User : HTTP 400 Bad Request (Error: Formato de fecha inválido)
end
deactivate Srv
deactivate Ctrl
@enduml
